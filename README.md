# This repo is archived

# audicin-track-api


Minimal [Spring Boot](http://projects.spring.io/spring-boot/) application for serving audio tracks and allowing partners to license them at any given point.

## Requirements

For building and running the application you need:

- [JDK 17+]([http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html](https://docs.aws.amazon.com/corretto/latest/corretto-17-ug/downloads-list.html)) - any other JDK either 17 is adequate for setting up the **audcin-track-api** backend server.
- [Maven 3.9.9](https://maven.apache.org/docs/history.html)


## Setting up .env variables

Firstly, copy the **example.env** to **.env** since it is the file which contains all application critical variables for launching the server, setting jwt encryption properties and API admin credentials.

### Run the command

```shell
cp example.env .env
```

The example.env file has the below variables, ensure that {insert_here} spots are filled with proper variables. 

```
server.port={insert_here}

spring.datasource.username={insert_here}
spring.datasource.password={insert_here}
spring.datasource.url=jdbc:sqlite:memory:myDb?cache=shared
spring.datasource.driver-class-name=org.sqlite.JDBC
spring.jpa.database-platform=org.hibernate.community.dialect.SQLiteDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true

security.jwt.secret-key={insert_here}
# 24h in millisecond = 8640000 recommended
security.jwt.expiration-time={insert_here}

audicin.api.admin.username={insert_here}
audicin.api.admin.email={insert_here}
audicin.api.admin.fullname={insert_here}
audicin.api.admin.password={insert_here}

springdoc.swagger-ui.path=/swagger-ui.html
springdoc.show-login-endpoint=true
```

**springdoc.swagger-ui.path** contains the path in which you will be able to find an **OpenAPI v3** specification of **audicin-track-api**


## Running the application locally

There are several ways to run a Spring Boot application on your local machine, especially if you have a proper IDE for Java.
JetBrains IntelliJ IDEA(https://www.jetbrains.com/idea/) is highly recommended, and this was used in the making of this project.

However if you want to run the application from any terminal, like zsh, or ssh you have to build the project with **mvn** as show below:

```shell
mvn clean install
```

or 

```shell
mvn clean install -DskipTests
```

if you want to skip JUNIT tests

To fire up the server on port **8000** or any other port of you liking:

```shell
mvn spring-boot:run
```

## Usin the **audicin-track-api** API

The easiest to acccess the API is through the OpenAPI swagger endpoint at 

```
http://localhost:{your_port}/swagger-ui/index.html/
```

In this Swagger File you will find 4 folders for:
* **auth-controller** - No Bearer Token needed
  User login - signup - authorization endpoints | after each **/login** you receive a Bearer Token which you could use to access **license-controller**
  **track-controller**   **user-controller** endpoints. In order to include this token in your api calls you need click the icon on the upper right corner **Authorize**
  to include the token which you will receive from the **/login** action.

  **POST /login** response will resemble this example response, in which **token** can be used in the calls mentioned above:

```
{
  "token": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMUBnbWFpbC5jb20iLCJpYXQiOjE3NDY4MTYzMTUsImV4cCI6MTc0NjgyNDk1NX0.RH8AjBqlskgQJLwdZs6vIZKMaoC6SLHRvJuqZm5Vxj8",
  "expiresIn": 8640000
}
```
 **POST /signup** is used for registering users.


* **user-controller** - | **Bearer token is needed**

  Returns data related to the user who holds an issued Token. User can be of type "Partner" or "Admin" and each one of them has different privlleges regarding
  the creation of **tracks** and **licenses**. 

  **GET /users/me** gives details about the logged in user.

  **GET /users** is accessible from a user who has the role **Admin**, in this case there is only one user which is generated by the application itself during the
   initial phase of the runtime and the credentials can be found on the **.env** which you previously modified by inserting your own **audicin.api.admin** credentials

* tracks - tracks-controller  | **Bearer token is needed**

  **POST /tracks** which requires **only** Admin rights for creating new tracks into the database.

  **GET /tracks** which required **only** Partner rights for accessing available tracks.


* **licenses** - license-controller | **Bearer token is needed** | All calls require Partener rights

   **GET /license** gets all the licenses, signed by their respective partner, in this case the current logged in user

   **POST /license** 

     The user can obtain trackIds from the **GET /tracks** method and insert them as a query parameter in order to license a track of his choice.

# Design choices

  ## ⚙️ Design Choices

1. **Clear Layer Separation**  
   Controllers for handling HTTP requests,services manage business logic,  db-services. repositories manage database access.

2. **RESTful API Structure**  
   Endpoints follow REST conventions with clean, resource-based Urls according to the assignment's requirements.

3. **Use of DTOs**  
   Data Transfer Objects are used in order to display the right amount of information to each respective user of the API.

4. **Global Exception Handling**  
    Exceptions are caught in the **com.audicin.backend.track.api.security.exceptions.GlobalExceptionHandler.java** class using `@RestControllerAdvice`, 

    which handles generic api calls, but it could be further improved by introducing more specific exceptions and error explanations for license and track api 
    actions.

5. **Role-Based Access Control**  
   Security rules are applied directly on endpoints using annotations (e.g., only `PARTNER` roles can access specific resources).

6. **Authenticated User Context**  
   The backend extracts the current user from the security context to ensure secure and personalized access to resources.

7. **Input Validation**  
   Request parameters are validated using annotations like `@NotNull` to catch errors early.


